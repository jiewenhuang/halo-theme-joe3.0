(function(){let e={limited:!1,initCopy(){if(PageAttrs.metas_enable_copy===`false`||!ThemeConfig.enable_copy)return;let e=location.href,t=$(`.joe_detail`).attr(`data-author`),n=$(`.joe_detail .joe_detail__title`).text(),r=$(`html head meta[name=description]`).attr(`content`);$(`.joe_detail__article`).on(`copy`,function(i){let a=window.getSelection(),o=a.toString().replace(/<已自动折叠>/g,``),s=(ThemeConfig.enable_copy_right_text?ThemeConfig.copy_right_text||`\r\n\r\n====================================\r\n文章作者： ${t}\r\n文章来源： ${ThemeConfig.blog_title}(${ThemeConfig.blog_url})\r\n文章标题： ${n}\r\n文章链接： ${e}\r\n版权声明： 内容遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。`:``).replace(/{postUrl}/g,e).replace(/{postTitle}/g,n).replace(/{postAuthor}/g,t).replace(/{BlogTitle}/g,ThemeConfig.blog_title).replace(/{BlogUrl}/g,ThemeConfig.blog_url).replace(/{postDescription}/g,r);if(window.clipboardData){let e=o+s;return window.clipboardData.setData(`Text`,e),!1}else{let e=document.body,t=o+s,n=document.createElement(`pre`);n.style.position=`absolute`,n.style.left=`-99999px`,e.appendChild(n),n.innerText=t,a.selectAllChildren(n),setTimeout(function(){e.removeChild(n)},0)}})},initShare(){PageAttrs.metas_enable_share===`false`||!ThemeConfig.enable_share||(ThemeConfig.enable_share_link&&$(`.icon-share-link`).length&&$(`.icon-share-link`).each((e,t)=>{let n=$(t)[0],r=n.dataset.postTitle,i=n.dataset.postDescription,a=n.dataset.postAuthor,o=n.dataset.template,s=window.location.href;o&&(s=o.replace(/{postUrl}/g,location.href).replace(/{postTitle}/g,r).replace(/{postAuthor}/g,a).replace(/{postDescription}/g,i).replace(/{BlogTitle}/g,ThemeConfig.blog_title).replace(/{BlogUrl}/g,ThemeConfig.blog_url),/{postUrl}/.test(o)||(s+=` ，文章链接: ${location.href}`)),new ClipboardJS(n,{text:()=>s}).on(`success`,()=>Qmsg.success(`文章链接已复制`))}),ThemeConfig.enable_share_weixin&&$(`.qrcode_wx`).length&&$(`.qrcode_wx`).qrcode({width:140,height:140,render:`canvas`,typeNumber:-1,correctLevel:0,background:`#ffffff`,foreground:`#000000`,text:location.href}))},initLike(){if(PageAttrs.metas_enable_like===`false`||!ThemeConfig.enable_like||!$(`.joe_detail__agree`).length)return;let e=$(`.joe_detail`).attr(`data-cid`),t=+($(`.joe_detail`).attr(`data-clikes`)||0),n=localStorage.getItem(encryption(`agree`))?JSON.parse(decrypt(localStorage.getItem(encryption(`agree`)))):[],r=n.includes(e),i=$(`.joe_detail__agree, .post-operate-like`),a=i.find(`.icon-like`),o=i.find(`.icon-unlike`),s=i.find(`.nums`);r?o.addClass(`active`):a.addClass(`active`),s.html(t);let c=!1;a.on(`click`,function(l){l.stopPropagation(),!c&&(c=!0,n=localStorage.getItem(encryption(`agree`))?JSON.parse(decrypt(localStorage.getItem(encryption(`agree`)))):[],r=n.includes(e),$.ajax({url:`/apis/api.halo.run/v1alpha1/trackers/upvote`,type:`post`,contentType:`application/json; charset=utf-8`,data:JSON.stringify({group:`content.halo.run`,plural:`posts`,name:e})}).then(c=>{let l=t;if(r){l--;let t=n.findIndex(t=>t===e);n.splice(t,1),o.removeClass(`active`),a.addClass(`active`),i.removeClass(`active`)}else l++,n.push(e),a.removeClass(`active`),o.addClass(`active`),i.addClass(`active`);let u=encryption(`agree`),d=encryption(JSON.stringify(n));localStorage.setItem(u,d),s.html(l).show()}).catch(e=>{c=!1}))})},initToc(t){if(PageAttrs.metas_enable_toc===`false`||!ThemeConfig.enable_toc||!$(`.toc-container`).length)return;if(PageAttrs.metas_use_raw_content===`true`){$(`#js-toc`).html(`<div class="toc-nodata">暂不支持解析原始内容目录</div>`),$(`.toc-container`).show();return}if(PageAttrs.metas_enable_read_limit===`true`&&!t&&e.limited){$(`#js-toc`).html(`<div class="toc-nodata">文章内容不完整，目录仅评论后可见</div>`),$(`.toc-container`).show();return}let n=$(`html`),r=$(`.joe_header__mask`),i=$(`.joe_action .toc`),a=$(`.joe_header__toc`),o=$(`#js-toc`),s=$(`#js-toc-mobile`);tocbot.init({tocSelector:Joe.isMobile?`#js-toc-mobile`:`#js-toc`,contentSelector:`.joe_detail__article`,ignoreSelector:`.js-toc-ignore`,headingSelector:`h1,h2,h3,h4,h5,h6`,collapseDepth:+(PageAttrs.metas_toc_depth||ThemeConfig.toc_depth||0),scrollSmooth:!0,includeTitleTags:!0,hasInnerContainers:!1,headingsOffset:80,scrollSmoothOffset:-80,positionFixedSelector:`.toc-container`,positionFixedClass:`is-position-fixed`,fixedSidebarOffset:`auto`,onClick:function(e){Joe.isMobile&&(n.removeClass(`disable-scroll`),a.removeClass(`active`),r.removeClass(`active slideout`)),window.tocPhase=!0},scrollEndCallback:function(e){window.tocPhase=null}}),Joe.isMobile?!s.children().length&&s.html(`<div class="toc-nodata"><em></em>暂无目录</div>`):!o.children().length&&o.html(`<div class="toc-nodata">暂无目录</div>`),Joe.isMobile&&(i.show(),i.on(`click`,()=>{window.sessionStorage.setItem(`lastScroll`,n.scrollTop()),n.addClass(`disable-scroll`),r.addClass(`active slideout`),a.addClass(`active`)})),$(`.toc-container`).show()},initAsideOperate(){if($(`.post-operate-comment`).on(`click`,function(e){let t=document.querySelector(`.joe_comment`),n=document.querySelector(`.joe_header`);if(!t||!n)return;if(e.stopPropagation(),!document.querySelector(`[id*="comment-"]`)&&!document.querySelector(`#waline`)){Qmsg.warning(`评论功能不可用！`);return}let r=t.offsetTop-n.offsetHeight-15;window.scrollTo({top:r})}),Joe.isMobile)return;let e=$(`.aside_operations`),t=$(`.joe_detail__agree,.joe_detail__operate-share,.joe_detail__operate .joe_donate`),n=n=>{$(`.joe_post`)[0].getBoundingClientRect().left<75?(e.hide(),t.show()):(e.show(),t.hide())};n(),window.addEventListener(`resize`,Utils.throttle(n),500)},initProgress(){if(!ThemeConfig.enable_progress_bar)return;$(window).off(`scroll`);let e=$(`.joe_progress_bar`),t,n,r,i=t=>e.css(`width`,t*100+`%`);$(window).on(`scroll`,function(e){e.stopPropagation(),t=$(window).height(),n=$(`body`).height(),r=n-t,window.requestAnimationFrame(function(){i(Math.max(0,Math.min(1,$(window).scrollTop()/r)))})})},initVideo(){if($(`.joe_detail__article-video`).length){let e=$(`.joe_detail__article-video .play iframe`).attr(`data-player`);$(`.joe_detail__article-video .episodes .item`).on(`click`,function(t){t.stopPropagation(),$(this).addClass(`active`).siblings().removeClass(`active`);let n=$(this).attr(`data-src`);$(`.joe_detail__article-video .play iframe`).attr({src:e+n})}),$(`.joe_detail__article-video .episodes .item`).first().click()}},async jumpToComment(){if(ThemeConfig.enable_clean_mode||!ThemeConfig.enable_comment||PageAttrs.metas_enable_comment===`false`)return;let{cid:e=``,p:t=``}=Utils.getUrlParams();if(e){await Utils.sleep(1e3);try{let n=document.getElementsByTagName(`halo-comment`);if(!n)return;let r=$(n[0].shadowRoot.getElementById(`halo-comment`)).find(`#comment-`+e);if(!r)return;let i=r.offset().top-50;window.scrollTo({top:i});let a=r.find(`.markdown-content`).eq(0);a.addClass(`blink`),await Utils.sleep(2e3),a.removeClass(`blink`),window.history.replaceState(null,null,t?`?p=${t}`:location.origin+location.pathname),tocbot.refresh()}catch(e){console.info(e)}}}};(function(){let t=[`jumpToComment`];document.addEventListener(`DOMContentLoaded`,function(){Object.keys(e).forEach(n=>!t.includes(n)&&typeof e[n]==`function`&&e[n]())}),window.addEventListener(`load`,function(){t.length===1?e[t[0]]():t.forEach(t=>t!==`loadingBar`&&e[t]&&e[t]())})})()})();