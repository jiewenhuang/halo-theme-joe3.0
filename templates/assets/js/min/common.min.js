(function(){window.encryption=e=>window.btoa(unescape(encodeURIComponent(e))),window.decrypt=e=>decodeURIComponent(escape(window.atob(e)));let e={initMode(){if(`scrollRestoration`in history&&(history.scrollRestoration=`manual`),ThemeConfig.theme_mode!==`user`)return;let t=$(`html`),n=$(`.mode-light`),r=$(`.mode-dark`),i=localStorage.getItem(`data-mode`);n[`${i===`light`?`remove`:`add`}Class`](`active`),r[`${i===`light`?`add`:`remove`}Class`](`active`),$(`.joe_action_item.mode`).on(`click`,function(a){a.stopPropagation();try{i=localStorage.getItem(`data-mode`);let a=``;i?(a=i===`light`?`dark`:`light`,n[`${i===`light`?`add`:`remove`}Class`](`active`),r[`${i===`light`?`remove`:`add`}Class`](`active`)):(a=`dark`,n.removeClass(`active`),r.addClass(`active`)),t.attr(`data-mode`,a),t.attr(`data-color-scheme`,a),localStorage.setItem(`data-mode`,a),e.initCommentTheme()}catch(e){console.log(e)}})},loadingBar:{show(){ThemeConfig.enable_loading_bar&&(NProgress.configure({easing:`ease`,speed:500,showSpinner:!1}),NProgress.start())},hide(){ThemeConfig.enable_loading_bar&&NProgress.done(!0)}},initNavbar(){let e=$(`.joe_header__above-nav a`),t=$(`.panel-side-menu .link`),n=0,{href:r,pathname:i}=location;e.each((e,t)=>{let a=t.getAttribute(`href`);(i.includes(a)||r.includes(a))&&(n=e)});let a=e.eq(n);a.addClass(`current`),a.parents(`.joe_dropdown`).length&&a.parents(`.joe_dropdown`).find(`.joe_dropdown__link a`).addClass(`current`),t.eq(n).addClass(`current`)},initFooter(){!ThemeConfig.enable_footer||ThemeConfig.footer_position!==`fixed`||$(`#Joe`).css(`margin-bottom`,$(`.joe_footer`).height()+30)},initCommentTheme(){let e=Joe.bloggerGenerateAvatarOpts;(e.textColor&&/var\(--([\w-]+)\)/.test(e.textColor)||e.bgColor&&/var\(--([\w-]+)\)/.test(e.bgColor))&&Joe.replaceAllTextAvatarImage()},initCode(e){let t=$(`.page-post pre, .page-journals pre, .page-sheet pre`);t.length&&t.each(function(t,n){let r=$(n);if(r.find(`code`).length>0){if(e){r.find(`.code-expander`).off(`click`).on(`click`,function(e){e.stopPropagation();let t=$(this),n=t.parent(`pre`).siblings(`.toolbar`).find(`.autofold-tip`);n&&n.remove(),t.parent(`pre`).toggleClass(`close`)});return}if(ThemeConfig.enable_code_title&&r.addClass(`c_title`),ThemeConfig.enable_code_hr&&r.addClass(`c_hr`),ThemeConfig.enable_code_macdot&&r.addClass(`c_macdot`),ThemeConfig.enable_code_newline&&r.addClass(`c_newline`),ThemeConfig.show_tools_when_hover&&r.addClass(`c_hover_tools`),ThemeConfig.enable_code_expander&&(r.prepend(`<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>`).addClass(`c_expander`),r.find(`.code-expander`).on(`click`,function(e){e.stopPropagation();let t=$(this),n=t.parent(`pre`).siblings(`.toolbar`).find(`.autofold-tip`);n&&n.remove(),t.parent(`pre`).toggleClass(`close`)})),ThemeConfig.enable_code_copy){let e=r.find(`code[class*="language-"]`).text(),t=$(`<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>`);new ClipboardJS(t[0],{text:()=>e}).on(`success`,()=>Qmsg.success(`复制成功！`)),r.addClass(`c_copy`).append(t)}}})},foldCode(){$(`.page-post`).length&&ThemeConfig.enable_code_expander&&ThemeConfig.enable_fold_long_code&&PageAttrs.metas_enable_fold_long_code!==`false`&&$(`.page-post pre[class*='language-']`).each(function(e,t){let n=$(t);n.height()>ThemeConfig.long_code_height&&(n.siblings(`.toolbar`).find(`.toolbar-item span`).eq(0).append(`<em class="autofold-tip"><已自动折叠></em>`),n.addClass(`close`))})},initBaidu(){!ThemeConfig.check_baidu_collect||!$(`#joe_baidu_record`).length||Utils.request({url:ThemeConfig.BASE_URL+`/halo-api/bd/iscollect`,method:`GET`,returnRaw:!0,data:{url:ThemeConfig.blog_url+window.location.pathname}}).then(e=>{if(e.data&&e.data.collected)$(`#joe_baidu_record`).css(`color`,`#67c23a`).html(`已收录`);else if(ThemeConfig.baidu_token){$(`#joe_baidu_record`).html(`<span style="color: #e6a23c">未收录，推送中...</span>`);let e=setTimeout(function(){Utils.request({url:ThemeConfig.BASE_URL+`/halo-api/bd/push`,method:`POST`,returnRaw:!0,data:{site:ThemeConfig.blog_url,token:ThemeConfig.baidu_token,urls:window.location.href}}).then(e=>{e.data.success===0?$(`#joe_baidu_record`).html(`<span style="color: #f56c6c">推送失败，请检查！</span>`):$(`#joe_baidu_record`).html(`<span style="color: #67c23a">推送成功！</span>`)}).catch(e=>{console.log(e)}),clearTimeout(e),e=null},1e3)}else{let e=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$(`#joe_baidu_record`).html(`<a target="_blank" href="${e}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}}).catch(e=>{console.log(e)})},initMusic(){ThemeConfig.enable_global_music_player&&Utils.request({url:`${ThemeConfig.music_api}?server=${ThemeConfig.music_source}&type=${ThemeConfig.music_player_type}&id=${ThemeConfig.music_list_id}`,type:`GET`,returnRaw:!0}).then(e=>{new APlayer({container:document.getElementById(`global-aplayer`),fixed:!0,lrcType:0,theme:ThemeConfig.music_player_theme,autoplay:ThemeConfig.music_auto_play,volume:ThemeConfig.music_player_volume,loop:ThemeConfig.music_loop_play,audio:e})}).catch(e=>{console.log(e)})},initPDF(){let e=$(`joe-pdf`);e.length&&e.each((e,t)=>{let n=$(t);options={src:n.attr(`src`)||``,width:n.attr(`width`)||`100%`,height:n.attr(`height`)||`500px`};let r=``;r=options.src?`
      <div class="joe_pdf">
        <iframe src="${ThemeConfig.BASE_RES_URL}/assets/lib/pdfjs/web/viewer.html?file=${options.src}" style="width:${options.width};height:${options.height}"></iframe>
      </div>`:`<p>pdf地址未填写！</p>`,$(t).replaceWith(r)})},back2Top(){if(!ThemeConfig.enable_back2top)return;let e=$(`.joe_action_item.back2top`),t=()=>{e[((document.documentElement.scrollTop||document.body.scrollTop)>300?`add`:`remove`)+`Class`](`active`)};t(),$(document).on(`scroll`,Utils.throttle(t,120)),e.on(`click`,function(e){e.stopPropagation(),$(`html,body`).animate({scrollTop:0},ThemeConfig.enable_back2top_smooth?500:0)})},initTimeCount(){if(Joe.isMobile||!$(`.joe_aside__item.timelife`).length)return;let e=[{title:`今日已经过去`,endTitle:`小时`,num:0,percent:`0%`},{title:`这周已经过去`,endTitle:`天`,num:0,percent:`0%`},{title:`本月已经过去`,endTitle:`天`,num:0,percent:`0%`},{title:`今年已经过去`,endTitle:`个月`,num:0,percent:`0%`}];{let t=(+new Date-new Date(new Date().toLocaleDateString()).getTime())/1e3/60/60,n=t/24*100;e[0].num=parseInt(t),e[0].percent=parseInt(n)+`%`}{let t={0:7,1:1,2:2,3:3,4:4,5:5,6:6}[new Date().getDay()],n=t/7*100;e[1].num=parseInt(t),e[1].percent=parseInt(n)+`%`}{let t=new Date().getFullYear(),n=new Date().getDate(),r=new Date().getMonth()+1,i=n/new Date(t,r,0).getDate()*100;e[2].num=n,e[2].percent=parseInt(i)+`%`}{let t=new Date().getMonth()+1,n=t/12*100;e[3].num=t,e[3].percent=parseInt(n)+`%`}let t=``;e.forEach((e,n)=>{t+=`
						<div class="item">
							<div class="title">
								${e.title}
								<span class="text">${e.num}</span>
								${e.endTitle}
							</div>
							<div class="progress">
								<div class="progress-bar">
									<div class="progress-bar-inner progress-bar-inner-${n}" style="width: ${e.percent}"></div>
								</div>
								<div class="progress-percentage">${e.percent}</div>
							</div>
						</div>`}),$(`.joe_aside__item.timelife .joe_aside__item-contain`).html(t)},initWeather(){Joe.isMobile||!ThemeConfig.enable_weather||!ThemeConfig.weather_token||!$(`#tp-weather-widget`).length||((function(e,t,n,r,i,a,o,s){s=function(){a=t.createElement(n),o=t.getElementsByTagName(n)[0],a.src=i,a.charset=`utf-8`,a.async=1,o.parentNode.insertBefore(a,o)},e.SeniverseWeatherWidgetObject=r,e[r]||(e[r]=function(){(e[r].q=e[r].q||[]).push(arguments)}),e[r].l=+new Date,e.attachEvent?e.attachEvent(`onload`,s):e.addEventListener(`load`,s,!1)})(window,document,`script`,`SeniverseWeatherWidget`,`//cdn.sencdn.com/widget2/static/js/bundle.js?t=`+parseInt((new Date().getTime()/1e8).toString(),10)),window.SeniverseWeatherWidget(`show`,{flavor:`slim`,location:`WX4FBXXFKE4F`,geolocation:!0,language:`zh-Hans`,unit:`c`,theme:`auto`,token:ThemeConfig.weather_token,hover:`disabled`,container:`tp-weather-widget`}))},initGallery(){let e=$(`.page-post .joe_detail__article img:not([class]), .page-journals .joe_journal_block img:not([class]), .page-sheet img:not([class])`);e.length&&e.each(function(){let e=$(this);e.wrap($(`<span style="display: block;" data-fancybox="Joe" href="${e.attr(`src`)}"></span>`))})},initExternalLink(){let e;if(ThemeConfig.link_behavior!==`default`){if(e=$(`.joe_main_container a[href]`),!e.length)return;e.each(function(){let e=$(this);if(!e.attr(`href`).includes(`javascript:;`)){let t=``;t=ThemeConfig.link_behavior===`new`&&!e.attr(`href`).startsWith(`#`)?`_blank`:``,e.attr({target:t,rel:`noopener noreferrer nofollow`})}})}else{if(e=$(`.page-post .joe_detail__article a[href], .joe_journal_body a[href], .page-sheet .joe_detail__article a[href]`),!e.length)return;e.each(function(){let e=$(this),t=e.attr(`href`);if(!t.includes(`javascript:;`)){let n=t.startsWith(`#`)?``:`_blank`;e.attr({target:n,rel:`noopener noreferrer nofollow`})}})}},init3dCloud(e){let t=e===`tag`,n=t?`tags-3d`:`categories-3d`,r=t?`.tags-cloud-list`:`.categories-cloud-list`,i=[],a=`#F8D800.#0396FF.#EA5455.#7367F0.#32CCBC.#F6416C.#28C76F.#9F44D3.#F55555.#736EFE.#E96D71.#DE4313.#D939CD.#4C83FF.#F072B6.#C346C2.#5961F9.#FD6585.#465EFB.#FFC600.#FA742B.#5151E5.#BB4E75.#FF52E5.#49C628.#00EAFF.#F067B4.#F067B4.#ff9a9e.#00f2fe.#4facfe.#f093fb.#6fa3ef.#bc99c4.#46c47c.#f9bb3c.#e8583d.#f68e5f`.split(`.`),o=(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e);ThemeConfig[`${e}_cloud_type`]=document.getElementById(n)?`3d`:`list`,ThemeConfig[`enable_${e}_cloud`]=document.querySelector(`.joe_aside__item.tags-cloud`)!==null,!(Joe.isMobile||!ThemeConfig[`enable_${e}_cloud`]||ThemeConfig[`${e}_cloud_type`]!==`3d`||!$(r).length)&&$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/lib/3dtag/3dtag.min.js`,e=>{$(r+` a`).each((e,t)=>{i.push({label:$(t).attr(`data-label`),url:$(t).attr(`data-url`),target:`_blank`,fontColor:a[o(0,a.length-1)],fontSize:16})}),$(`#${n}`).svg3DTagCloud({entries:i,width:250,height:250,radius:`65%`,radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(r).remove(),$(`#${n} .empty`).remove()})},init3dTag(){this.init3dCloud(`tag`)},init3dCategory(){this.init3dCloud(`category`)},initDropMenu(){$(`.joe_dropdown`).each(function(e,t){let n=$(this).find(`.joe_dropdown__menu`),r=$(t).attr(`trigger`)||`click`,i=$(t).attr(`placement`)||$(this).height()||0;n.css(`top`,i),r===`hover`?$(this).hover(()=>$(this).addClass(`active`),()=>$(this).removeClass(`active`)):($(this).on(`click`,function(e){e.stopPropagation(),$(this).toggleClass(`active`),$(document).one(`click`,()=>$(this).removeClass(`active`)),e.stopPropagation()}),n.on(`click`,e=>e.stopPropagation()))})},drawerMobile(){$(`.joe_header__above-slideicon`).on(`click`,function(e){e.stopPropagation(),$(`.joe_header__searchout`).removeClass(`active`);let t=$(`html`),n=$(`.joe_header__mask`),r=$(`.joe_header__slideout`);r.hasClass(`active`)?(t.removeClass(`disable-scroll`),n.removeClass(`active slideout`),r.removeClass(`active`)):(window.sessionStorage.setItem(`lastScroll`,t.scrollTop()),t.addClass(`disable-scroll`),n.addClass(`active slideout`),r.addClass(`active`))})},maskClose(){$(`.joe_header__mask`).on(`click`,function(e){e.stopPropagation();let t=$(`html`);t.removeClass(`disable-scroll`),$(`.joe_header__mask`).removeClass(`active slideout`),$(`.joe_header__searchout`).removeClass(`active`),$(`.joe_header__slideout`).removeClass(`active`),$(`.joe_header__toc`).removeClass(`active`),$(`.joe_header__above`).removeClass(`solid`);let n=window.sessionStorage.getItem(`lastScroll`);n&&t.scrollTop(n),window.sessionStorage.removeItem(`lastScroll`)}).on(`touchmove`,e=>e.preventDefault)},sideMenuMobile(){$(`.joe_header__slideout-menu .current`).parents(`.panel-body`).show().siblings(`.panel`).addClass(`in`),$(`.joe_header__slideout-menu .panel`).on(`click`,function(e){e.stopPropagation();let t=$(this),n=t.parent().parent();n.find(`.panel`).not(t).removeClass(`in`),n.find(`.panel-body`).not(t.siblings(`.panel-body`)).stop().hide(`fast`),t.toggleClass(`in`).siblings(`.panel-body`).stop().toggle(`fast`)})},initHeadScroll(){if(Joe.isMobile||ThemeConfig.enable_fixed_header)return;let e=0,t=0,n=$(`.joe_header__above`),r=$(`.joe_aside_post, .joe_aside .joe_aside__item:last-child`),i=n.height();if(r)var a=i+15,o=i-60+15;document.addEventListener(`scroll`,Utils.throttle(()=>{window.tocPhase||(e=window.scrollY,t<e&&e>i?(n.addClass(`active`),r&&r.css(`top`,o)):t>e&&(n.removeClass(`active`),r&&r.css(`top`,a)),t=e)},100))},cancelSpaceScroll(){document.body.onkeydown=function(e){e||=window.event;let t=e.target||e.srcElement;if((e.keyCode||e.charCode)===32){if([`text`,`input`,`textarea`,`halo-comment`,`halo-comment`,`comment-widget`].includes(t.tagName.toLowerCase()))return;window.event?e.returnValue=!1:e.preventDefault()}}},scrollToHash(e,t=0){if(e||=window.decodeURIComponent(location.hash),!e)return;let n=$(`.joe_header`).height(),r=$(e);if(r&&r.length>0){let e=r.offset().top-n-15;t>0?$(`html,body`).animate({scrollTop:e},t):document.documentElement.scrollTop=e}},loadMouseEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||ThemeConfig.cursor_effect===`off`||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/cursor/${ThemeConfig.cursor_effect}.js`)},loadBackdropEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||ThemeConfig.backdrop===`off`||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/backdrop/${ThemeConfig.backdrop}.js`)},setFavicon(){if(!ThemeConfig.favicon)return;let e=new Favico,t=new Image;t.onload=function(){e.image(t)},t.src=ThemeConfig.favicon},offscreenTip(){if(Joe.isMobile||!ThemeConfig.enable_offscreen_tip)return;let e=document.title,t=null;document.addEventListener(`visibilitychange`,function(){location.href.indexOf(ThemeConfig.blog_url)>0||location.pathname!==`/`||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||`歪，你去哪里了？`,clearTimeout(t)):(document.title=ThemeConfig.offscreen_title_back||`(つェ⊂)咦，又回来了!`,t=setTimeout(function(){document.title=e},2e3)))})},initBirthday(){if(!ThemeConfig.enable_birthday)return;if(!/^\d+$/.test(ThemeConfig.birthday)&&!/^(\d{4}\/\d{1,2}\/\d{1,2}\s\d{1,2}:\d{1,2}(:\d{0,2})?)$/.test(ThemeConfig.birthday)){Qmsg.error(`“自定义博客起始时间” 格式错误，请检查！`);return}let e=new Date(/^\d+$/g.test(ThemeConfig.birthday)?+ThemeConfig.birthday:ThemeConfig.birthday),t=$(`.joe_run__day`),n=$(`.joe_run__hour`),r=$(`.joe_run__minute`),i=$(`.joe_run__second`),a=()=>{let a=(+new Date-e.getTime())/(1e3*24*60*60),o=Math.floor(a),s=(a-o)*24,c=Math.floor(s),l=(s-c)*60,u=Math.floor(l),d=(l-u)*60,f=Math.floor(d);a=String(o).padStart(2,0),s=String(c).padStart(2,0),l=String(u).padStart(2,0),d=String(f).padStart(2,0),t.html(a),n.html(s),r.html(l),i.html(d)};a(),setInterval(a,1e3)},showLoadTime(){if(Joe.isMobile||!ThemeConfig.show_loaded_time)return;let e=performance.now();e&&console.log(`%c页面加载耗时：`+Math.round(e)+` ms`,`padding: 6px 8px;color:#fff;background:linear-gradient(270deg, #4edb21, #f15206);border-radius: 3px;`)},debug(){ThemeConfig.enable_debug&&new window.VConsole},clean(){$(`#compatiable-checker`).remove(),$(`#theme-config-getter`).remove(),$(`#metas-getter`).remove(),$(`#theme-config-getter`).remove(),e.loadingBar.hide()},travelling(){function e(){let e=[];return document.querySelectorAll(`.joe_detail__friends-item`).forEach(t=>{let n={spec:{url:t.querySelector(`a`).getAttribute(`href`),displayName:t.querySelector(`.sub-text`).innerText},metadata:{annotations:{link_enable_show:`true`}}};e.push(n)}),e}function t(e,t){return t>e.length?null:e.sort(()=>.5-Math.random()).slice(0,t)}function n(e){let n=document.querySelector(`.joe_action_item.random`);n&&n.addEventListener(`click`,function(){if(e.length>0){let n=t(e,1)[0],r=n.spec.url,i=`即将跳转到：「`+n.spec.displayName+`」`;Qmsg.success(i),setTimeout(()=>{window.open(r,`_blank`)},3e3)}})}function r(){n(e())}r()}};(function(){let t=[`loadingBar`,`init3dTag`,`init3dCategory`,`foldCode`,`loadMouseEffect`,`loadBackdropEffect`,`setFavicon`,`initUV`,`showLoadTime`,`debug`,`clean`,`travelling`];document.addEventListener(`DOMContentLoaded`,function(){e.loadingBar.show(),Object.keys(e).forEach(n=>!t.includes(n)&&e[n]())}),window.addEventListener(`load`,function(){t.length===1?e[t[0]]():t.forEach(t=>t!==`loadingBar`&&e[t]&&e[t]())})})(),window.commonContext=e})();