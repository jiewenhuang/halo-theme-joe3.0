window.encryption=e=>window.btoa(unescape(encodeURIComponent(e))),window.decrypt=e=>decodeURIComponent(escape(window.atob(e)));const commonContext={initMode(){if("scrollRestoration"in history&&(history.scrollRestoration="manual"),"user"===ThemeConfig.theme_mode){const t=$("html"),a=$(".mode-light"),n=$(".mode-dark");let o=localStorage.getItem("data-mode");a[`${"light"===o?"remove":"add"}Class`]("active"),n[`${"light"===o?"add":"remove"}Class`]("active"),$(".joe_action_item.mode").on("click",function(e){e.stopPropagation();try{o=localStorage.getItem("data-mode");let e="";o?(e="light"===o?"dark":"light",a[`${"light"===o?"add":"remove"}Class`]("active"),n[`${"light"===o?"remove":"add"}Class`]("active")):(e="dark",a.removeClass("active"),n.addClass("active")),t.attr("data-mode",e),localStorage.setItem("data-mode",e),commonContext.initCommentTheme()}catch(e){console.log(e)}})}},loadingBar:{show(){ThemeConfig.enable_loading_bar&&(NProgress.configure({easing:"ease",speed:500,showSpinner:!1}),NProgress.start())},hide(){ThemeConfig.enable_loading_bar&&NProgress.done(!0)}},initNavbar(){var e=$(".joe_header__above-nav a"),o=$(".panel-side-menu .link");let t=0;const{href:a,pathname:n}=location;e.each((e,o)=>{o=o.getAttribute("href");(n.includes(o)||a.includes(o))&&(t=e)});e=e.eq(t);e.addClass("current"),e.parents(".joe_dropdown").length&&e.parents(".joe_dropdown").find(".joe_dropdown__link a").addClass("current"),o.eq(t).addClass("current")},initFooter(){ThemeConfig.enable_footer&&"fixed"===ThemeConfig.footer_position&&$("#Joe").css("margin-bottom",$(".joe_footer").height()+30)},initCommentTheme(){var o=document.getElementsByTagName("halo-comment"),t=document.querySelector("html").getAttribute("data-mode");for(let e=0;e<o.length;e++){var a=o[e].shadowRoot.getElementById("halo-comment");$(a)[`${"light"===t?"remove":"add"}Class`]("dark")}},initCode(n){var e=$(".page-post pre, .page-journals pre, .page-sheet pre");e.length&&e.each(function(e,o){o=$(o);if(0<o.find("code").length)if(n)o.find(".code-expander").off("click").on("click",function(e){e.stopPropagation();var e=$(this),o=e.parent("pre").siblings(".toolbar").find(".autofold-tip");o&&o.remove(),e.parent("pre").toggleClass("close")});else if(ThemeConfig.enable_code_title&&o.addClass("c_title"),ThemeConfig.enable_code_hr&&o.addClass("c_hr"),ThemeConfig.enable_code_macdot&&o.addClass("c_macdot"),ThemeConfig.enable_code_newline&&o.addClass("c_newline"),ThemeConfig.show_tools_when_hover&&o.addClass("c_hover_tools"),ThemeConfig.enable_code_expander&&(o.prepend('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>').addClass("c_expander"),o.find(".code-expander").on("click",function(e){e.stopPropagation();var e=$(this),o=e.parent("pre").siblings(".toolbar").find(".autofold-tip");o&&o.remove(),e.parent("pre").toggleClass("close")})),ThemeConfig.enable_code_copy){const a=o.find("code[class*='language-']").text();var t=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(t[0],{text:()=>a}).on("success",()=>Qmsg.success("复制成功！")),o.addClass("c_copy").append(t)}})},foldCode(){$(".page-post").length&&ThemeConfig.enable_code_expander&&ThemeConfig.enable_fold_long_code&&"false"!==PageAttrs.metas_enable_fold_long_code&&$(".page-post pre[class*='language-']").each(function(e,o){o=$(o);o.height()>ThemeConfig.long_code_height&&(o.siblings(".toolbar").find(".toolbar-item span").eq(0).append('<em class="autofold-tip"><已自动折叠></em>'),o.addClass("close"))})},initBaidu(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",method:"GET",returnRaw:!0,data:{url:ThemeConfig.blog_url+window.location.pathname}}).then(e=>{if(e.data&&e.data.collected)$("#joe_baidu_record").css("color","#67c23a").html("已收录");else if(ThemeConfig.baidu_token){$("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>');let e=setTimeout(function(){Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",method:"POST",returnRaw:!0,data:{site:ThemeConfig.blog_url,token:ThemeConfig.baidu_token,urls:window.location.href}}).then(e=>{0===e.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}).catch(e=>{console.log(e)}),clearTimeout(e),e=null},1e3)}else{e="https://ziyuan.baidu.com/linksubmit/url?sitename="+encodeURI(window.location.href);$("#joe_baidu_record").html(`<a target="_blank" href="${e}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}}).catch(e=>{console.log(e)})},initMusic(){ThemeConfig.enable_global_music_player&&Utils.request({url:`${ThemeConfig.music_api}?server=${ThemeConfig.music_source}&type=${ThemeConfig.music_player_type}&id=`+ThemeConfig.music_list_id,type:"GET",returnRaw:!0}).then(e=>{new APlayer({container:document.getElementById("global-aplayer"),fixed:!0,lrcType:0,theme:ThemeConfig.music_player_theme,autoplay:ThemeConfig.music_auto_play,volume:ThemeConfig.music_player_volume,loop:ThemeConfig.music_loop_play,audio:e})}).catch(e=>{console.log(e)})},initPDF(){var e=$("joe-pdf");e.length&&e.each((e,o)=>{var t=$(o);options={src:t.attr("src")||"",width:t.attr("width")||"100%",height:t.attr("height")||"500px"};let a="";a=options.src?`
      <div class="joe_pdf">
        <iframe src="/themes/theme-Joe3/assets/lib/pdfjs/web/viewer.html?file=${options.src}" style="width:${options.width};height:${options.height}"></iframe>
      </div>`:"<p>pdf地址未填写！</p>",$(o).replaceWith(a)})},back2Top(){if(ThemeConfig.enable_back2top){const o=$(".joe_action_item.back2top");var e=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop;o[(300<e?"add":"remove")+"Class"]("active")};e(),$(document).on("scroll",Utils.throttle(e,120)),o.on("click",function(e){e.stopPropagation(),$("html,body").animate({scrollTop:0},ThemeConfig.enable_back2top_smooth?500:0)})}},initTimeCount(){if(!Joe.isMobile&&$(".joe_aside__item.timelife").length){var e=[{title:"今日已经过去",endTitle:"小时",num:0,percent:"0%"},{title:"这周已经过去",endTitle:"天",num:0,percent:"0%"},{title:"本月已经过去",endTitle:"天",num:0,percent:"0%"},{title:"今年已经过去",endTitle:"个月",num:0,percent:"0%"}],o=(+new Date-new Date((new Date).toLocaleDateString()).getTime())/1e3/60/60,a=o/24*100;e[0].num=parseInt(o),e[0].percent=parseInt(a)+"%";var o={0:7,1:1,2:2,3:3,4:4,5:5,6:6}[(new Date).getDay()],a=o/7*100,o=(e[1].num=parseInt(o),e[1].percent=parseInt(a)+"%",(new Date).getFullYear()),a=(new Date).getDate(),n=(new Date).getMonth()+1,o=a/new Date(o,n,0).getDate()*100,n=(e[2].num=a,e[2].percent=parseInt(o)+"%",(new Date).getMonth()+1),a=n/12*100;e[3].num=n,e[3].percent=parseInt(a)+"%";let t="";e.forEach((e,o)=>{t+=`
						<div class="item">
							<div class="title">
								${e.title}
								<span class="text">${e.num}</span>
								${e.endTitle}
							</div>
							<div class="progress">
								<div class="progress-bar">
									<div class="progress-bar-inner progress-bar-inner-${o}" style="width: ${e.percent}"></div>
								</div>
								<div class="progress-percentage">${e.percent}</div>
							</div>
						</div>`}),$(".joe_aside__item.timelife .joe_aside__item-contain").html(t)}},initWeather(){!Joe.isMobile&&ThemeConfig.enable_weather&&ThemeConfig.weather_key&&$("#he-plugin-simple").length&&(window.WIDGET={CONFIG:{modules:"120",background:"5",tmpColor:"FFFFFF",tmpSize:"13",cityColor:"FFFFFF",citySize:"13",aqiColor:"FFFFFF",aqiSize:"13",weatherIconSize:"13",alertIconSize:"13",padding:"5px 5px 4px 5px",shadow:"0",language:"auto",borderRadius:"4",fixed:"true",vertical:"top",horizontal:"left",key:ThemeConfig.weather_key}},$.getScript("https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"))},initGallery(){var e=$(".page-post .joe_detail__article img:not([class]), .page-journals .joe_journal_block img:not([class]), .page-sheet img:not([class])");e.length&&e.each(function(){var e=$(this);e.wrap($(`<span style="display: block;" data-fancybox="Joe" href="${e.attr("src")}"></span>`))})},initExternalLink(){let e;"default"!==ThemeConfig.link_behavior?(e=$(".joe_main_container a[href]")).length&&e.each(function(){var e,o=$(this);o.attr("href").includes("javascript:;")||(e="",e="new"!==ThemeConfig.link_behavior||o.attr("href").startsWith("#")?"":"_blank",o.attr({target:e,rel:"noopener noreferrer nofollow"}))}):(e=$(".page-post .joe_detail__article a[href], .joe_journal_body a[href], .page-sheet .joe_detail__article a[href]")).length&&e.each(function(){var e=$(this),o=e.attr("href");o.includes("javascript:;")||(o=o.startsWith("#")?"":"_blank",e.attr({target:o,rel:"noopener noreferrer nofollow"}))})},init3dTag(){!Joe.isMobile&&ThemeConfig.enable_tag_cloud&&"3d"===ThemeConfig.tag_cloud_type&&$(".tags-cloud-list").length&&$.getScript("/themes/theme-Joe3/assets/lib/3dtag/3dtag.min.js",e=>{const a=[],n=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"];$(".tags-cloud-list a").each((e,o)=>{var t;a.push({label:$(o).attr("data-label"),url:$(o).attr("data-url"),target:"_blank",fontColor:n[o=0,t=n.length-1,o=Math.ceil(o),t=Math.floor(t),Math.floor(Math.random()*(t-o+1))+o],fontSize:16})}),$("#tags-3d").svg3DTagCloud({entries:a,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(".tags-cloud-list").remove(),$("#tags-3d .empty").remove()})},initDropMenu(){$(".joe_dropdown").each(function(e,o){var t=$(this).find(".joe_dropdown__menu"),a=$(o).attr("trigger")||"click",o=$(o).attr("placement")||$(this).height()||0;t.css("top",o),"hover"===a?$(this).hover(()=>$(this).addClass("active"),()=>$(this).removeClass("active")):($(this).on("click",function(e){e.stopPropagation(),$(this).toggleClass("active"),$(document).one("click",()=>$(this).removeClass("active")),e.stopPropagation()}),t.on("click",e=>e.stopPropagation()))})},drawerMobile(){$(".joe_header__above-slideicon").on("click",function(e){e.stopPropagation(),$(".joe_header__searchout").removeClass("active");var e=$("html"),o=$(".joe_header__mask"),t=$(".joe_header__slideout");t.hasClass("active")?(e.removeClass("disable-scroll"),o.removeClass("active slideout"),t.removeClass("active")):(window.sessionStorage.setItem("lastScroll",e.scrollTop()),e.addClass("disable-scroll"),o.addClass("active slideout"),t.addClass("active"))})},searchMobile(){$(".joe_header__above-searchicon").on("click",function(e){e.stopPropagation(),$(".joe_header__slideout").removeClass("active");var e=$("html"),o=($(".joe_header__mask"),$(".joe_header__above")),t=$(".joe_header__searchout");t.hasClass("active")?(e.removeClass("disable-scroll"),t.removeClass("active"),o.removeClass("solid")):(window.sessionStorage.setItem("lastScroll",e.scrollTop()),e.addClass("disable-scroll"),o.addClass("solid"),t.addClass("active"))})},maskClose(){$(".joe_header__mask").on("click",function(e){e.stopPropagation();var e=$("html"),o=(e.removeClass("disable-scroll"),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").removeClass("active"),$(".joe_header__toc").removeClass("active"),$(".joe_header__above").removeClass("solid"),window.sessionStorage.getItem("lastScroll"));o&&e.scrollTop(o),window.sessionStorage.removeItem("lastScroll")}).on("touchmove",e=>e.preventDefault)},sideMenuMobile(){$(".joe_header__slideout-menu .current").parents(".panel-body").show().siblings(".panel").addClass("in"),$(".joe_header__slideout-menu .panel").on("click",function(e){e.stopPropagation();var e=$(this),o=e.parent().parent();o.find(".panel").not(e).removeClass("in"),o.find(".panel-body").not(e.siblings(".panel-body")).stop().hide("fast"),e.toggleClass("in").siblings(".panel-body").stop().toggle("fast")})},initHeadScroll(){if(!Joe.isMobile&&!ThemeConfig.enable_fixed_header){let e=0,o=0;const n=$(".joe_header__above"),i=$(".joe_aside_post, .joe_aside .joe_aside__item:last-child"),l=n.height();var t,a;i&&(t=l+15,a=l-60+15);document.addEventListener("scroll",Utils.throttle(()=>{window.tocPhase||(e=window.scrollY,o<e&&e>l?(n.addClass("active"),i&&i.css("top",a)):o>e&&(n.removeClass("active"),i)&&i.css("top",t),o=e)},100))}},renderReplyEmoji(){$(".aside-reply-content").each((e,o)=>{var t=marked(o.innerHTML).replace(/<img\ssrc[^>]*>/gm,'<i class="joe-font joe-icon-tupian"></i>').replace(/bili\//g,"bili/hd/ic_emoji_"),t=Utils.renderedEmojiHtml(t);o.innerHTML=Utils.return2Br(t)})},cancelSpaceScroll(){document.body.onkeydown=function(e){var o=(e=e||window.event).target||e.srcElement;32!==(e.keyCode||e.charCode)||["text","input","textarea","halo-comment"].includes(o.tagName.toLowerCase())||(window.event?e.returnValue=!1:e.preventDefault())}},scrollToHash(e,o=0){var t;(e=e||window.decodeURIComponent(location.hash))&&(t=$(".joe_header").height(),e=$(e))&&0<e.length&&(e=e.offset().top-t-15,0<o?$("html,body").animate({scrollTop:e},o):document.documentElement.scrollTop=e)},loadMouseEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.cursor_effect||$.getScript(`/themes/theme-Joe3/assets/effect/cursor/${ThemeConfig.cursor_effect}.js`)},loadBackdropEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.backdrop||$.getScript(`/themes/theme-Joe3/assets/effect/backdrop/${ThemeConfig.backdrop}.js`)},setFavicon(){if(ThemeConfig.favicon){const e=new Favico,o=new Image;o.onload=function(){e.image(o)},o.src=ThemeConfig.favicon}},offscreenTip(){if(!Joe.isMobile&&ThemeConfig.enable_offscreen_tip){const o=document.title;let e=null;document.addEventListener("visibilitychange",function(){0<location.href.indexOf(ThemeConfig.blog_url)||"/"!==location.pathname||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||"歪，你去哪里了？",clearTimeout(e)):(document.title=ThemeConfig.offscreen_title_back||"(つェ⊂)咦，又回来了!",e=setTimeout(function(){document.title=o},2e3)))})}},initBirthday(){if(ThemeConfig.enable_birthday)if(/^\d+$/.test(ThemeConfig.birthday)||/^(\d{4}\/\d{1,2}\/\d{1,2}\s\d{1,2}:\d{1,2}(:\d{0,2})?)$/.test(ThemeConfig.birthday)){const r=new Date(/^\d+$/g.test(ThemeConfig.birthday)?+ThemeConfig.birthday:ThemeConfig.birthday),c=$(".joe_run__day"),d=$(".joe_run__hour"),m=$(".joe_run__minute"),h=$(".joe_run__second");var e=()=>{var e=(+new Date-r.getTime())/864e5,o=Math.floor(e),t=24*(e-o),a=Math.floor(t),n=60*(t-a),i=Math.floor(n),l=60*(n-i),s=Math.floor(l),e=String(o).padStart(2,0),t=String(a).padStart(2,0),n=String(i).padStart(2,0),l=String(s).padStart(2,0);c.html(e),d.html(t),m.html(n),h.html(l)};e(),setInterval(e,1e3)}else Qmsg.error("“自定义博客起始时间” 格式错误，请检查！")},showLoadTime(){var e;!Joe.isMobile&&ThemeConfig.show_loaded_time&&(e=performance.now())&&console.log("%c页面加载耗时："+Math.round(e)+" ms","padding: 6px 8px;color:#fff;background:linear-gradient(270deg, #4edb21, #f15206);border-radius: 3px;")},debug(){ThemeConfig.enable_debug&&new window.VConsole},clean(){$("#compatiable-checker").remove(),$("#theme-config-getter").remove(),$("#metas-getter").remove(),$("#theme-config-getter").remove(),commonContext.loadingBar.hide()}};!function(){const o=["loadingBar","init3dTag","foldCode","loadMouseEffect","loadBackdropEffect","setFavicon","initUV","showLoadTime","debug","clean"];document.addEventListener("DOMContentLoaded",function(){commonContext.loadingBar.show(),Object.keys(commonContext).forEach(e=>!o.includes(e)&&commonContext[e]())}),window.addEventListener("load",function(){1===o.length?commonContext[o[0]]():o.forEach(e=>"loadingBar"!==e&&commonContext[e]&&commonContext[e]())})}(),window.commonContext=commonContext;