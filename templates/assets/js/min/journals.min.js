(function(){let e={initEffect(){$(`.joe_loading`).remove(),$(`.joe_journals__list`).removeClass(`hidden`),ThemeConfig.enable_journal_effect&&new WOW({boxClass:`wow`,animateClass:ThemeConfig.journal_list_effect_class||`fadeIn`,offset:0,mobile:!0,live:!0}).init()},formatTime(){$(`.joe_journal-posttime`).each(function(){let e=$(this);e.html(Utils.timeAgo(e.text()))})},initLike(){if(!ThemeConfig.enable_like_journal)return;let e=$(`.joe_journal__item`);e.length&&e.each(function(e,t){let n=$(this),r=n.attr(`data-cid`),i=+(n.attr(`data-clikes`)||0),a=localStorage.getItem(encryption(`agree-journal`))?JSON.parse(decrypt(localStorage.getItem(encryption(`agree-journal`)))):[],o=a.includes(r),s=n.find(`.journal-like`),c=n.find(`.journal-unlike`),l=n.find(`.journal-likes-num`);o?(s.hide(),c.show()):(s.show(),c.hide()),l.html(i),s.on(`click`,function(e){e.stopPropagation();let t=!1;t||(t=!0,a=localStorage.getItem(encryption(`agree-journal`))?JSON.parse(decrypt(localStorage.getItem(encryption(`agree-journal`)))):[],o=a.includes(r),$.ajax({url:`/apis/api.halo.run/v1alpha1/trackers/upvote`,type:`post`,contentType:`application/json; charset=utf-8`,data:JSON.stringify({group:`moment.halo.run`,plural:`moments`,name:r})}).then(e=>{let t=i;if(o){t--;let e=a.findIndex(e=>e===r);a.splice(e,1),s.show(),c.hide()}else t++,a.push(r),s.hide(),c.show();let n=encryption(`agree-journal`),u=encryption(JSON.stringify(a));localStorage.setItem(n,u),l.html(t)}).catch(e=>{t=!1}))})})},initComment(){ThemeConfig.enable_clean_mode||!ThemeConfig.enable_comment_journal||$(`.journal_comment_expander,.journal-comment`).on(`click`,function(e){e.stopPropagation();let t=$(this).parents(`.footer-wrap`);console.log(`ping`),t.toggleClass(`open`),t.find(`.journal_comment_expander_txt`).html((t.hasClass(`open`)?`收起`:`查看`)+`评论`)})},initExpander(){$(`.journal_content_expander i`).on(`click`,function(e){e.stopPropagation(),$(this).parents(`.joe_journal_body`).toggleClass(`open`)})},foldBlock(){$(`.joe_journal_body .content-wrp`).each(function(){let e=$(this);e[0].getBoundingClientRect().height>=ThemeConfig.journal_block_height&&e.siblings(`.journal_content_expander`).show()})}};(function(){let t=[`foldBlock`];document.addEventListener(`DOMContentLoaded`,function(){Object.keys(e).forEach(n=>!t.includes(n)&&e[n]())}),window.addEventListener(`load`,function(){e.foldBlock()})})()})();